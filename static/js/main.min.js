M.AutoInit();var video_id=null;var img_blob=null;var img_ts=null;var processing=false;var play_duration=0;var vid_duration=0;var download_counter=0;function check_set_processing(){let e=processing;processing=true;return e}$("#video_form").submit((function(e){e.preventDefault();if(check_set_processing()){alert("Please wait untill previous action is finished.");return}let t=document.getElementById("canvas");t.getContext("2d").clearRect(0,0,t.width,t.height);$("#analysis_parent_cont").hide();$("#canvas_actions").hide();$(".analysis_category").empty();let i=$(this).serializeArray();let n=i[0].value;let a=null;dot_be=n.indexOf("youtu.be/");if(dot_be!=-1){dot_be+=9;a=n.substring(dot_be,dot_be+11)}else{query_params=new URLSearchParams(n.split("watch?")[1]);a=query_params.get("v")}add_video(a)}));function add_video(e){$("#video_cont").empty();let t=new URLSearchParams;t.set("video_id",e);t.set("token",$("#t").data("t"));$("#video_cont").append(`<video id="video" width="100%" class="responsive-video" src="/get_video?${t.toString()}" controls> \n        This browser does not support the HTML5 video element.\n    </video>`);$("#video_cont_parent").show();document.getElementById("video").scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});$("#video").on("error",(function(e){alert("Sorry, this video is not supported for playback.");$(this).get(0).pause()}));$("#video").on("timeupdate",(function(){play_duration++;if(play_duration===480){alert("You have been watching for 2 mins. Please note that this app is not intended for watching Youtube videos. If you continue watching you will be redirected in 1 min.")}else if(play_duration===720){alert("You have been watching for 3 mins. Please note that this app is not intended for watching Youtube videos. You will redirected to YouTube now.");window.location.replace(`https://youtube.com/watch?v=${video_id}`)}}));video_id=e;$("#screen_capture_ctrls").show();processing=false}$("#screen_capture_form").submit((function(e){e.preventDefault();if(check_set_processing()){alert("Please wait untill previous action is finished.");return}let t=document.getElementById("video");t.pause();$("#analysis_parent_cont").hide();$(".analysis_category").empty();$("#canvas_actions").hide();$("#loading").show();document.getElementById("loading").scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});let i=$(this).serializeArray();let n=i.find((function(e){return e.name==="frame_source"})).value;let a=null;if(n==="timestamp"){a=i.find((function(e){return e.name==="time_stamp"})).value;let e=a.split(":");let n=60*parseInt(e[0])+parseInt(e[1]);if(n<0||n>t.duration){$("#loading").hide();alert("Timestamp not valid");processing=false;return}a=n;t.currentTime=n;t.addEventListener("canplay",(function e(i){t.removeEventListener("canplay",e);draw_frame()}))}else{draw_frame();a=t.currentTime}img_ts=a}));function draw_frame(){let e=document.getElementById("canvas");let t=document.getElementById("video");e.width=t.videoWidth;e.height=t.videoHeight;e.getContext("2d").drawImage(t,0,0,t.videoWidth,t.videoHeight);e.toBlob(e=>{img_blob=e;link=(window.URL?URL:webkitURL).createObjectURL(e);$("#down_link").attr("href",link)});$("#loading").hide();$("#canvas_actions").show();document.getElementById("canvas").scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});processing=false}$(".search_btns").click((function(e){if(check_set_processing()){alert("Please wait untill previous action is finished.");return}if(img_blob===null||img_ts===null){alert("You need to capture an image first before analyzing it");processing=false;return}$("#analysis_parent_cont").hide();$("#loading").show();document.getElementById("loading").scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});let t=new URLSearchParams;t.set("screen_ts",img_ts);t.set("video_id",video_id);t.set("token",$("#t").data("t"));var i=new XMLHttpRequest;i.open("POST","/analyze_image?"+t.toString(),true);i.onload=function(e){if(this.status!=200){alert("Search & Analysis failed. Please reload the page and try again");console.error("analysis failed");$("#loading").hide();processing=false}else{render_vision_results(JSON.parse(this.response))}};i.send(img_blob)}));function show_siblings(e){$(e).siblings().show()}function add_list_to_markup(e,t,i,n){let a=0;let s;if(i==="url"){s=true}else{s=false}t.forEach(t=>{let o=t[i];if(o!=""){e.append(`<p ${a>n?"hidden":""}> \n                ${s?`<a href="${o}" target="_blank"> ${o} </a>`:`${o}`} </p>`);a++}});if(a>n){e.append('<a class="waves-effect waves-teal btn-flat" onclick="show_siblings(this)">show more</a>')}}function render_vision_results(e){console.log(e);$(".analysis_category").empty();$("#analysis ul li").show();for(var t in e){if(Object.prototype.hasOwnProperty.call(e,t)){let i=$(`li.${t}`);if(i.length!=0){if(e[t].length===0){console.log(i,"should be hidden");i.hide()}else{i=$(`div.${t}`);let n="description";if(t==="webDetection"){let a=["bestGuessLabels","webEntities","pagesWithMatchingImages","visuallySimilarImages"];let s={bestGuessLabels:"Best Guess Labels",webEntities:"Web Entities",pagesWithMatchingImages:"Pages With Matching Images",visuallySimilarImages:"Visually Similar Images"};a.forEach(o=>{if(o==="bestGuessLabels"){n="label"}else if(o.includes("Images")){n="url"}else if(o==="webEntities"){n="description"}if(e[t][o].length!=0){i.append("<h5>"+s[o]+"</h5>");let l=$("<div>",{id:`${o}_cont`,class:"analysis_subcategory"});i.append(l);add_list_to_markup(l,e[t][o],n,5);if(a.indexOf(o)<a.length-1){i.append('<div class="divider"></div>')}}})}else{add_list_to_markup(i,e[t],n,5)}}}}}$("#loading").hide();$("#analysis_parent_cont").show();document.getElementById("analysis").scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});processing=false}function toggle_ts(e){if(e.value==="current"&&e.checked){$("#time_stamp").val("");$("#time_stamp").attr("disabled",true)}else if(e.value==="timestamp"&&e.checked){$("#time_stamp").attr("disabled",false);$("#time_stamp").attr("required",true)}}$("#contact_form").submit((function(e){e.preventDefault();let t=$(this).serialize();console.log(t);$.post(`/contact_submit?token=${$("#t").data("t")}`,$(this).serialize()).done((function(e){M.toast({html:"Message Delivered"})}))}));$("#down_link").on("click",(function(e){download_counter++;if(download_counter>10){e.preventDefault();$(this).attr("href","#");$(this).removeAttr("download");$(this).hide();alert("You cannot download more than 10 video frames");$(this).off("click")}}));function scroll_to_features(){document.getElementById("features").scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}